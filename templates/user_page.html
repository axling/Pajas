{% extends "base.html"%}

{% block scripts %}
<script src="/delete_points.js"></script>
<script src="/edit_point.js"></script>
{% endblock %}

{% block body %}
<h3 class="page-header">Pajas points for <div class="fb_uid_name" id="{{ user }}"></div></h3>
<table id="rounded-corner" summary="Your Pajaspoints">
  <thead>
    <tr>
      <th class="rounded-head-left">Reason</th>
      <th colspan="3" class="rounded-head-right">Given By</th>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <th colspan="4">Add Pajaspoint for <div class="fb_uid_name" id="{{ user }}"></th>
    </tr>
    <tr>
      <form id="add_point" method="post" 
	    action="/user_page/{{user}}/{{points.number}}">
	<th>
	  <textarea rows="2" cols="30" name="description"></textarea>
	</th>
	<th colspan="3">
	  <input type="submit" value="Add Pajas Point" />
	  <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
	</th>
      </form>
    </tr>
    <tr>
      <th class="rounded-foot-left">
	{% if points.has_previous %}
	<a href="/user_page/{{user}}/{{points.previous_page_number}}">Previous
	</a>
	{% endif %}
      </th>
      <th colspan="2">Page {{points.number}} of {{points.paginator.num_pages}}
      </th>
      <th class="rounded-foot-right">
	{% if points.has_next %}
	<a href="/user_page/{{user}}/{{points.previous_page_number}}">Next
	</a>
	{% endif %}
      </th>
    </tr>
  </tfoot>
  <tbody>
    {% for point in points.object_list %}
    <tr>
      <td><span class="description">{{ point.description }}</span></td>
      {% ifequal point.pajas_id logged_in_user.user_id %}
      <td><div class="fb_uid" id="{{ point.issuer_id }}"></div></td>
      <td>
	{% ifequal point.issuer_id logged_in_user.user_id %}
	<div>
	  <form>
	    <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
	    <input type="hidden" name="edit_point_tag" value="{{point.key}}" />
	  </form>
	  <input type="image" class="edit-point-img" 
		 src="/images/pen_small.png" title="Edit" />    
	</div>
	{% endifequal %}
      </td>
      <td>
	<form method="post" class="delete-point" 
	      action="/user_page/{{ user }}/{{points.number}}">
	  <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
	  <input type="hidden" name="remove_point_tag" value="{{point.key}}" />
	  <input type="image" src="/images/cancel.png" title="Remove" />    
	</form>
      </td>
      {% else %}
      {% ifequal point.issuer_id logged_in_user.user_id %}
      <td><div class="fb_uid" id="{{ point.issuer_id }}"></div></td>
      <td>
	<div>
	  <form>
	    <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
	    <input type="hidden" name="edit_point_tag" value="{{point.key}}" />
	  </form>
	  <input type="image" class="edit-point-img" 
		 src="/images/pen_small.png" title="Edit" />    
	</div>
      </td>
      <td>	
	<form method="post" class="delete-point" 
	      action="/user_page/{{ user }}/{{points.number}}">
	  <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
	  <input type="hidden" name="remove_point_tag" value="{{point.key}}" />
	  <input type="image" src="/images/cancel.png" title="Remove" />
	</form>
      </td>
      {% else %}
      <td colspan="3">
	<div class="fb_uid" id="{{ point.issuer_id }}"></div>
      </td>
      {% endifequal %}  
      {% endifequal %}  
    </tr>
    {% empty %}
    <tr>
      <td colspan="4">No pajaspoints exists for <div class="fb_uid_name" id="{{ user }}">
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
